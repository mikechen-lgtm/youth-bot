# JSON 转 Markdown 转换工具使用说明

## 功能说明

该脚本会自动收集 `rag_data` 目录中的所有 JSON 文件，按活动日期分类生成两个 Markdown 文件：

- **`過去活動.md`** - 活动日期在今天之前的活动
- **`近期活動.md`** - 今天到未来 3 个月内的活动

## 使用方法

### 基本用法

```bash
python scripts/convert_json_to_markdown.py
```

这会读取 `rag_data/` 目录中的所有 JSON 文件，并在同一目录生成分类后的 Markdown 文件。

### 指定输入目录

```bash
python scripts/convert_json_to_markdown.py --rag-dir /path/to/json/files
```

### 指定输出目录

```bash
python scripts/convert_json_to_markdown.py --output-dir /path/to/output
```

## 执行结果

脚本会输出详细的处理过程：

```
🚀 開始處理...
   輸入目錄：rag_data
   輸出目錄：rag_data

📂 找到 3 個 JSON 檔案
  ✓ 桃園市政府青年事務局: 桃漾館試營運 - 2026/02/04
  ✓ 桃園青創事: A8產業轉型加速器 - 2026/02/05
  ⚠️  無法提取日期: 某些活動標題

📊 分類結果：
  過去活動：115 個
  近期活動（今天到未來3個月）：9 個

✅ 已生成：rag_data/過去活動.md
✅ 已生成：rag_data/近期活動.md

✨ 完成！檔案已儲存至 rag_data
```

## 生成文件格式

### 近期活動.md

```markdown
# 桃園市政府青年事務局 - 近期活動

**資料更新時間：** 2026/01/27 00:00
**活動數量：** 9 個
**時間範圍：** 2026/01/27 ~ 2026/04/27（未來3個月）

---

# 活動標題

**發布日期：** 2025/01/21 10:00
**活動日期：** 2026/02/04
**來源：** 桃園市政府青年事務局

---

## 內容
...

還有 8 天

---
```

### 過去活動.md

```markdown
# 桃園市政府青年事務局 - 過去活動

**資料更新時間：** 2026/01/27 00:00
**活動數量：** 115 個

---

# 活動標題

**發布日期：** 2025/01/20 12:00
**活動日期：** 2026/01/24
**來源：** 桃園市政府青年事務局

---

## 內容
...
```

## 日期提取规则

脚本会按以下优先级提取活动日期：

1. **结构化数据** - `post.time.event` 或 `post.event_time`
2. **ISO 格式** - `YYYY/MM/DD` 或 `YYYY-MM-DD`
3. **民国年** - `115年1月23日` → `2026/01/23`
4. **月日** - `1月24日` → 自动推断年份

如果无法提取日期，该活动将被跳过，不会出现在任何输出文件中。

## 时间分类逻辑

```python
今天 = 2026/01/27

如果 活动日期 < 今天:
    → 归入「過去活動.md」

如果 今天 <= 活动日期 <= 今天+90天:
    → 归入「近期活動.md」

如果 活动日期 > 今天+90天:
    → 不归入任何文件
```

## 排序规则

- **過去活動** - 按日期降序（最近的过期活动在前）
- **近期活動** - 按日期升序（最近即将举办的活动在前）

## 注意事项

1. **文件覆盖** - 每次运行会覆盖已存在的 `過去活動.md` 和 `近期活動.md`
2. **JSON 格式** - 只处理包含 `posts` 字段的 JSON 文件
3. **日期准确性** - 确保 JSON 中的日期格式正确，否则可能无法提取
4. **台北时区** - 所有时间计算使用 `Asia/Taipei` 时区

## 常见问题

### Q: 为什么某些活动没有被转换？

A: 可能原因：
- JSON 文件不包含 `posts` 字段
- 活动日期无法从内容中提取
- 日期格式不被支持

### Q: 如何更新活动分类？

A: 只需重新运行脚本，它会自动按当前日期重新分类所有活动。

### Q: 生成的文件编码是什么？

A: 所有文件使用 UTF-8 编码。

## 版本历史

- **v3.0** (2026-01-27) - 改为只生成两个分类文件（过去活动、近期活动）
- **v2.1** - 添加活动状态标注和日期计算
- **v1.0** - 初始版本，按源文件生成 Markdown
