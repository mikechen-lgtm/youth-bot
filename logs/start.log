==========================================
  Youth Chatbot 啟動腳本
==========================================

[後端] 啟動 Flask 服務...
[後端] PID: 21217
python-dotenv could not parse statement starting at line 35
python-dotenv could not parse statement starting at line 35
{"timestamp": "2026-01-27T09:22:09.311595+00:00", "level": "INFO", "logger": "rate_limiting", "message": "Rate limiter initialized with in-memory storage", "module": "rate_limiting", "function": "create_limiter", "line": 37}
{"timestamp": "2026-01-27T09:22:09.313853+00:00", "level": "INFO", "logger": "security_headers", "message": "Security headers configured (production=False)", "module": "security_headers", "function": "configure_security_headers", "line": 119}
{"timestamp": "2026-01-27T09:22:09.314617+00:00", "level": "INFO", "logger": "__main__", "message": "Attempting to initialize MySQL schema (attempt 1/3)...", "module": "app", "function": "ensure_mysql_schema_with_retry", "line": 532}
{"timestamp": "2026-01-27T09:22:09.332404+00:00", "level": "ERROR", "logger": "__main__", "message": "Failed to create MySQL schema: (pymysql.err.OperationalError) (1060, \"Duplicate column name 'member_id'\")\n[SQL: \n                        ALTER TABLE chat_sessions\n                        ADD COLUMN member_id INT,\n                        ADD CONSTRAINT fk_chat_sessions_member\n                        FOREIGN KEY (member_id) REFERENCES members(id) ON DELETE SET NULL\n                        ]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)", "module": "app", "function": "ensure_mysql_schema", "line": 523}
{"timestamp": "2026-01-27T09:22:09.333637+00:00", "level": "WARNING", "logger": "__main__", "message": "MySQL schema initialization failed (attempt 1/3): (pymysql.err.OperationalError) (1060, \"Duplicate column name 'member_id'\")\n[SQL: \n                        ALTER TABLE chat_sessions\n                        ADD COLUMN member_id INT,\n                        ADD CONSTRAINT fk_chat_sessions_member\n                        FOREIGN KEY (member_id) REFERENCES members(id) ON DELETE SET NULL\n                        ]\n(Background on this error at: https://sqlalche.me/e/20/e3q8). Retrying in 5 seconds...", "module": "app", "function": "ensure_mysql_schema_with_retry", "line": 538}

[前端] 啟動 Vite 開發伺服器...
[前端] PID: 21233

==========================================
  服務已啟動！
  前端: http://35.212.185.83:3000
  後端: http://localhost:8300
  按 Ctrl+C 關閉所有服務
==========================================

> AI Chatbot Interface@0.1.0 dev
> vite

Port 3000 is in use, trying another one...
Port 3001 is in use, trying another one...

  VITE v6.3.5  ready in 1237 ms

  ➜  Local:   http://localhost:3002/
  ➜  Network: http://10.138.0.3:3002/
{"timestamp": "2026-01-27T09:22:14.334035+00:00", "level": "INFO", "logger": "__main__", "message": "Attempting to initialize MySQL schema (attempt 2/3)...", "module": "app", "function": "ensure_mysql_schema_with_retry", "line": 532}
{"timestamp": "2026-01-27T09:22:14.345082+00:00", "level": "ERROR", "logger": "__main__", "message": "Failed to create MySQL schema: (pymysql.err.OperationalError) (1060, \"Duplicate column name 'member_id'\")\n[SQL: \n                        ALTER TABLE chat_sessions\n                        ADD COLUMN member_id INT,\n                        ADD CONSTRAINT fk_chat_sessions_member\n                        FOREIGN KEY (member_id) REFERENCES members(id) ON DELETE SET NULL\n                        ]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)", "module": "app", "function": "ensure_mysql_schema", "line": 523}
{"timestamp": "2026-01-27T09:22:14.345268+00:00", "level": "WARNING", "logger": "__main__", "message": "MySQL schema initialization failed (attempt 2/3): (pymysql.err.OperationalError) (1060, \"Duplicate column name 'member_id'\")\n[SQL: \n                        ALTER TABLE chat_sessions\n                        ADD COLUMN member_id INT,\n                        ADD CONSTRAINT fk_chat_sessions_member\n                        FOREIGN KEY (member_id) REFERENCES members(id) ON DELETE SET NULL\n                        ]\n(Background on this error at: https://sqlalche.me/e/20/e3q8). Retrying in 5 seconds...", "module": "app", "function": "ensure_mysql_schema_with_retry", "line": 538}
{"timestamp": "2026-01-27T09:22:19.345615+00:00", "level": "INFO", "logger": "__main__", "message": "Attempting to initialize MySQL schema (attempt 3/3)...", "module": "app", "function": "ensure_mysql_schema_with_retry", "line": 532}
{"timestamp": "2026-01-27T09:22:19.357302+00:00", "level": "ERROR", "logger": "__main__", "message": "Failed to create MySQL schema: (pymysql.err.OperationalError) (1060, \"Duplicate column name 'member_id'\")\n[SQL: \n                        ALTER TABLE chat_sessions\n                        ADD COLUMN member_id INT,\n                        ADD CONSTRAINT fk_chat_sessions_member\n                        FOREIGN KEY (member_id) REFERENCES members(id) ON DELETE SET NULL\n                        ]\n(Background on this error at: https://sqlalche.me/e/20/e3q8)", "module": "app", "function": "ensure_mysql_schema", "line": 523}
{"timestamp": "2026-01-27T09:22:19.357634+00:00", "level": "ERROR", "logger": "__main__", "message": "MySQL schema initialization failed after 3 attempts: (pymysql.err.OperationalError) (1060, \"Duplicate column name 'member_id'\")\n[SQL: \n                        ALTER TABLE chat_sessions\n                        ADD COLUMN member_id INT,\n                        ADD CONSTRAINT fk_chat_sessions_member\n                        FOREIGN KEY (member_id) REFERENCES members(id) ON DELETE SET NULL\n                        ]\n(Background on this error at: https://sqlalche.me/e/20/e3q8). Please check MySQL connection settings and ensure the database is running.", "module": "app", "function": "ensure_mysql_schema_with_retry", "line": 544}
Traceback (most recent call last):
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
    ~~~~~~~~~~^^^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/pymysql/connections.py", line 575, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/pymysql/connections.py", line 826, in _read_query_result
    result.read()
    ~~~~~~~~~~~^^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/pymysql/connections.py", line 1203, in read
    first_packet = self.connection._read_packet()
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/pymysql/connections.py", line 782, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.OperationalError: (1060, "Duplicate column name 'member_id'")

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/creative_design/youth-bot/app.py", line 551, in <module>
    ensure_mysql_schema_with_retry()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/creative_design/youth-bot/app.py", line 533, in ensure_mysql_schema_with_retry
    ensure_mysql_schema()
    ~~~~~~~~~~~~~~~~~~~^^
  File "/home/creative_design/youth-bot/app.py", line 450, in ensure_mysql_schema
    conn.execute(
    ~~~~~~~~~~~~^
        text(
        ^^^^^
    ...<6 lines>...
        )
        ^
    )
    ^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/sqlalchemy/sql/elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 2363, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/sqlalchemy/engine/default.py", line 952, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
    ~~~~~~~~~~^^^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/pymysql/connections.py", line 575, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/pymysql/connections.py", line 826, in _read_query_result
    result.read()
    ~~~~~~~~~~~^^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/pymysql/connections.py", line 1203, in read
    first_packet = self.connection._read_packet()
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/pymysql/connections.py", line 782, in _read_packet
    packet.raise_for_error()
    ~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "/home/creative_design/miniconda3/lib/python3.13/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (1060, "Duplicate column name 'member_id'")
[SQL: 
                        ALTER TABLE chat_sessions
                        ADD COLUMN member_id INT,
                        ADD CONSTRAINT fk_chat_sessions_member
                        FOREIGN KEY (member_id) REFERENCES members(id) ON DELETE SET NULL
                        ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Killed
